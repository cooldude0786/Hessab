<!-- $ git push https://github.com/cooldude0786/Hessab.git
 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <title>Records</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .border-bottom {
      border-bottom: 3px solid #DEE2F2 !important;
    }

    .border-money {
      border: 5px solid #dee2e6 !important;
    }

    .screenLoader {
      font-size: 30px;
      font-family: monospace;
      overflow: hidden;
      /* height: -webkit-fill-available; */
      max-height: 0;
      background-color: #8d98a3;
      width: 260px;
      position: absolute;
      top: 0;
      left: calc(50% - 130px);
      z-index: 1;
      right: 50%;
      transition: max-height .2s ease-out;
    }
  </style>
</head>

<!-- added now -->

<body>
  <div id="ScreenLoadar" class="d-flex justify-content-center text-danger rounded-bottom screenLoader">Connecting....
  </div>
  <!-- <div class="container"> -->
  <!-- <h2>Modal Example</h2> -->
  <!-- Button to Open the Modal -->
  <div class="col-md-12 d-flex justify-content-around row">
    <button type="button" class="btn btn-primary" id="modalToggleButton" data-toggle="modal" data-target="#myModal">
      Record
    </button>
    <button type="button" class="btn btn-primary" id="modalToggleButtonMoney" data-toggle="modal"
      data-target="#myModalMoney">
      Money Bhai
    </button>
  </div>
  <!-- Above button is to open reords -->


  <div class="modal fade" id="myModalMoney" tabindex="-1" aria-labelledby="MoneyModal" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="MoneyModal">Money Budget</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          money money money
          <div class="moneyinput">
            <div class="form-group">
              <label for="">Mount</label>
              <input type="number" value="1524" class="form-control" id="moneyinputval">
              <!-- <small id="helpId" class="form-text text-muted">Help text</small> -->
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" id="UpdateMoney" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div>



  <!-- The Modal Record -->
  <div class="modal" id="myModal" style="display: none;">
    <div class="modal-dialog">
      <div class="modal-content">
        <form id="recordentered">
          <div class="col-md-12 d-flex flex-column modal-header">
            <div class="d-flex w-100">
              <h4 class="modal-title">Enter Records</h4>
              <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="d-flex justify-content-end w-100">Date:-<span id="entrydate"></span></div>
          </div>
          <div class="modal-body">
            <div class="d-flex col-md-12 align-items-center p-0">
              <div class="col-md-4 text-center">Saaman ka naam daal </div>
              <div class="col-md-8 p-0">
                <input class="form-control p-1" id="SaamanName" name="SaamanName" value=null type="text">
              </div>
            </div>
            <div class="d-flex col-md-12 align-items-center p-0">
              <div class="col-md-4">Rupea daal </div>
              <div class="col-md-8 p-0 input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="basic-addon1">$</span>
                </div>
                <input class="form-control p-1" id="Paisa" name="Paisa" value=0 type="number">
              </div>
            </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        <!-- <button type="button" id="EnterDetails" class="btn btn-primary">Enter</button> -->
        <input type="submit" id="EnterDetails" class="btn btn-primary" value="Enter">
      </div>

    </div>
  </div>
  </div>

  <!-- modal 2 -->
  <div class="modal" id="entername" style="display: none;" data-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="col-md-12 d-flex flex-column modal-header">
          <div class="d-flex w-100">
            <h4 class="modal-title">Enter Name</h4>
          </div>
          <div class="d-flex justify-content-end w-100">Date:-</div>
        </div>
        <div class="modal-body">
          <div class="d-flex col-md-12 align-items-center p-0">
            <div class="col-md-4 text-center">Enter Name</div>
            <div class="col-md-8 p-0">
              <input class="form-control p-1" id="EnterName" name="EnterName" type="text">
            </div>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" id="EnterDetailOfUser" class="btn btn-primary">Enter</button>
        </div>

      </div>
    </div>
  </div>

  <div class="row col-md-12 p-3 justify-content-center bg-light m-0">
    <div class="bg-white col-md-5 rounded">
      <ul style="list-style:none;max-height: 70vh;" id="ulList" class="p-0 m-0 overflow-auto">
        <li class="col-sm-12 d-flex justify-content-around p-0 border-bottom my-1">
          <div class="col-sm-2 p-0 text-break">Timing</div>
          <div class="col-sm-6 flex-wrap p-0 text-break">item
          </div>
          <div class="col-sm-2 p-0">cost</div>
        </li>

        <li class="col-sm-12 d-flex justify-content-around p-0 border-bottom my-1">
          <div class="col-sm-2 p-0 text-break">Fri Jul </div>
          <div class="col-sm-6 flex-wrap p-0 text-break"> Auto to iasdfceeasnorbit </div>
          <div class="col-sm-2 p-0">140</div>
        </li>

      </ul>
    </div>

    <div id="moneyID" class=" text-break col-md-1 ">
      <div class="align-items-center border-money d-flex flex-wrap h-100 p-1">

        <div id="MoneyValue">dfhgbdhfdgnjtyfhjft</div>
        <small class="text-muted">With faded secondary text</small>
      </div>
    </div>

  </div>
  <!-- <button id="butt">hiii</button> -->
  <!-- </div> -->


  <script type="module">
    var name = 'khizar', Data;
    function LocalStorageName() {
      if (localStorage.getItem("MyCustomer") === null) {
        alert("naam daaal")
      } else if (localStorage.MyCustomer.length == 0) {
        alert("daala hai  par empty hai")
      }
      else {
        if (
          window.confirm(`Are you ${JSON.parse(localStorage.MyCustomer).id}`)
        ){
          alert("badhiya")
        }else{
          alert("array bhai bhai bhai")
        }
        
      }
    }
    LocalStorageName()

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js";
    const firebaseConfig = {
      apiKey: "AIzaSyCoPj0DvjAp8SWzSdhYwhWNb1GxieXQIZw",
      authDomain: "hessab-dfb99.firebaseapp.com",
      databaseURL: "https://hessab-dfb99-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "hessab-dfb99",
      storageBucket: "hessab-dfb99.appspot.com",
      messagingSenderId: "253864970407",
      appId: "1:253864970407:web:5df80f4b8212b331253382"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // console.log('this is app', app)
    import { getDatabase, ref, set, get, child, update, remove, onValue }
      from "https://www.gstatic.com/firebasejs/9.8.3/firebase-database.js"

    const database = getDatabase();
    const db = getDatabase();
    const connectedRef = ref(db, ".info/connected");
    onValue(connectedRef, (snap) => {
      if (snap.val() === true) {
        console.log("connected");
        $("#ScreenLoadar").css("max-height", "");  //Loader 
        // $('#entername').modal('show')
        // get_data()
        mOneyValue()
      } else {
        console.log("not connected");
        $("#ScreenLoadar").css("max-height", "40px"); //Loader 
      }
    });
    const dbRef = ref(getDatabase());
    function InsertUserEntry(saamaan, paisa) {
      return new Promise((resolve, reject) => {
        set(ref(db, `${name}/` + Date().slice(4, -31).split(' ').join('')), {
          iteam: saamaan,
          price: paisa,
          date: Date().slice(0, 8)
        })
          .then(() => {
            console.log("Enter Record");
            resolve({ status: 'succesful' })
            // return {status:'Sucessful'}
          })
          .catch((error) => { resolve({ status: 'succesful', error: error }) })
        // console.log()
      })

    }

    $('#EnterDetailOfUser').click(() => {
      name = $('#EnterName').val()
      // name.toLowerCase() = $('#EnterName').val()
      if (name == '1') {
        $('#entername').modal('show');
      } else {
        name = name.toLowerCase().trim()
        // console.log(name.length)
        get_data()
        $('#entername').modal('hide');
      }
    })
    $('#Paisa').focusin(() => {
      document.getElementById('Paisa').value = ''
      // console.log('at focus in', $('#Paisa').val())
    })
    $('#Paisa').focusout(() => {
      if ($('#Paisa').val() == 0) {
        // console.log('at focus out', $('#Paisa').val())
        document.getElementById('Paisa').value = 0
      } else {
        // console.log('gshdysv', $('#Paisa').val().length)
      }
    })
    $('#SaamanName').focusin(() => {
      document.getElementById('SaamanName').value = ' '
    })
    $('#SaamanName').focusout(() => {
      if ($('#SaamanName').val() == ' ') {
        document.getElementById('SaamanName').value = 'null'
      }
    })
    $('#EnterDetails').click(async () => {
      // console.log('kjsgdhvbfh', $('#SaamanName').val(), $('#Paisa').val())
      // let tempContent = `<li class="d-flex justify-content-around"> <div class="p-0">Iteam:</div> <div class="p-0">${$('#SaamanName').val()},</div> <div class="p-0">Cost:</div> <div class="p-0">${$('#Paisa').val()}</div></li>`
      // `<li>${$('#SaamanName').val()},${$('#Paisa').val()}`;
      if ($('#SaamanName').val() == 'null' || $('#Paisa').val() == 0) {
        // console.log('sahi se kar entry', name)
        alert('Enter Correct Value')
      } else {
        let result = await InsertUserEntry($('#SaamanName').val(), $('#Paisa').val())
        // document.getElementById('ulList').innerHTML += tempContent
        if (result.status == 'succesful') {
          get_data()
        } else {
          alert('Not Inserted' + result.error)
        }
        $('#myModal').modal('hide');
      }
    })
    $('#modalToggleButton').click(() => {
      document.getElementById('entrydate').innerText = Date().slice(4, 15)
    })
    function get_data() {
      let tempContent = '';
      get(child(dbRef, `${name}/moneyValue/`)).then((snapshot) => {
        if (snapshot.exists()) {
          let obj = snapshot.val()
          Data = obj
          // console.log(obj,Data)
          for (let k in obj) {// 'k' here represent the value of key's in the api.
            tempContent += `<li class="col-sm-12 d-flex justify-content-around p-0 border-bottom my-1"><div class="col-sm-2 p-0 text-break">${obj[k].date}</div><div class="col-sm-6 flex-wrap p-0 text-break">${obj[k].iteam}</div><div class="col-sm-2 p-0">${obj[k].price}</div></li>`
            // tempContent += `<li class="d-flex justify-content-around"> <div class="p-0">Iteam:</div> <div class="p-0">${obj[k].iteam},</div> <div class="p-0">Cost:</div> <div class="p-0">${obj[k].price}</div></li>`
            // console.log(k)
          }
          document.getElementById('ulList').innerHTML += tempContent
        } else {
          alert('Pervious Record Not Found')
        }
      })
    }
    $('#recordentered').keypress(function (event) {
      var keycode = (event.keyCode ? event.keyCode : event.which);
      if (keycode == '13') {
        if ($('#Paisa').val() == 0 || $('#SaamanName').val() == 'null' || $('#SaamanName').val() == ' ') {
          alert('You pressed a "enter" key in somewhere');
        } else {
          // let tempContent = `<li class="d-flex justify-content-around"> <div class="p-0">Iteam:</div> <div class="p-0">${$('#SaamanName').val()},</div> <div class="p-0">Cost:</div> <div class="p-0">${$('#Paisa').val()}</div></li>`
          // `<li>${$('#SaamanName').val()},${$('#Paisa').val()}`;
          if ($('#SaamanName').val() == 'null' || $('#Paisa').val() == 0) {
            console.log('sahi se kar entry', name)
          } else {
            InsertUserEntry($('#SaamanName').val(), $('#Paisa').val())
            // document.getElementById('ulList').innerHTML += tempContent
            $('#myModal').modal('hide');
          }
        }
      }
    });
    function mOneyValue() {
      get(child(ref(database), `${name}/moneyValue`)).then((snapshot) => {
        if (snapshot.exists()) {
          let moneyobj = snapshot.val()
          // for(let keys in moneyobj){
          //   console.log("value form-->",moneyobj[keys])
          // }
          console.log("Value from db if true", moneyobj[moneyobj.length - 1])
          updateMoneyValue(moneyobj[moneyobj.length - 1].Amount)
        } else {
          console.log("Value from db if false", snapshot)
        }
      })//get Close
    }//Func Close
    $('#UpdateMoney').click(async () => {
      let amount = document.getElementById('moneyinputval').value
      console.log(amount, typeof amount, typeof parseInt(amount), typeof amount)
      let myobj1 = {
        123: { 121: '23erfdgerdtg' },
        'Jul05202215:51:24': { date: 'Tue Jul ', iteam: ' 1111', price: '1212' }
      }
      // function call(id___) {
      //   return new Promise((resolve, reject) => {
      //   })
      // }
      // for( let k in myobj1){
      //   console.log('this is-->'+k)
      //   let a = await call(k)
      //   console.log(a)
      // }
      // the above function is to update the whole money_obj into the db by checking if id is their or nor
    })
    function updateMoneyValue(value_of_money) {
      $('#MoneyValue').text(value_of_money)
    }
  </script>
</body>

</html>